Notes=Backbone.Model.extend({initialize:function(){this.set("zoomLevel",1),this.totalDaysAtZoomLevel=[92,190,370],this.scopeStartDate=moment().subtract(45,"days"),this.scopeEndDate=this.scopeStartDate.clone().add(90,"days")},isAuthenticated:function(){this.storage.isAuthenticated()},connect:function(t){var e=this;this.storage=t?new Storage(this):new DemoStorage(this),this.storage.authenticate(function(t){e.set("username",t)})},setScopeBasedOnZoomLevel:function(){var t=this.get("zoomLevel"),e=this.totalDaysAtZoomLevel[t-1]/2,o=this.scopeStartDate.clone().add(this.scopeEndDate.diff(this.scopeStartDate,"days")/2,"days");this.scopeStartDate=o.clone().subtract(e,"days"),this.scopeEndDate=o.clone().add(e,"days")},getDateRangeInScope:function(){return[this.scopeStartDate.toDate(),this.scopeEndDate.toDate()]},adjustDatesInScope:function(t){this.scopeStartDate.add(t,"days"),this.scopeEndDate.add(t,"days")},getDateTicksInScope:function(){for(var t=[],e=this.scopeStartDate.clone().startOf("day"),o=this.get("zoomLevel");e.isBefore(this.scopeEndDate);)t.push(e.clone().toDate()),e.add(1,1==o?"days":"weeks");return t},getMonthsInScope:function(){for(var t=this.scopeStartDate.clone().startOf("month"),e=[];t.isBefore(this.scopeEndDate);)e.push([t.clone().toDate(),t.clone().endOf("month").endOf("day").toDate()]),t.add(1,"month");return e},getNoteTypes:function(){return _.sortBy(_.uniq(_.map(this.get("events"),function(t){return t.type})),function(t){return t})},getNotesInScope:function(){var t=this;return _.filter(this.get("events"),function(e){var o=moment(e.date);return o.isAfter(t.scopeStartDate)&&o.isBefore(t.scopeEndDate)})},deleteNote:function(t){this.storage.deleteEvent(t,this.get("events"))},addNote:function(t,e,o){var s=e.toLowerCase().trim(),a={id:t.hashCode(),content:t,type:s,date:o.toDate()};this.storage.createEvent(a)},zoom:function(t){var e=this.get("zoomLevel");t&&e>1?(this.set("zoomLevel",e-1),this.setScopeBasedOnZoomLevel(),this.trigger("change:scope")):!t&&3>e&&(this.set("zoomLevel",e+1),this.setScopeBasedOnZoomLevel(),this.trigger("change:scope"))},getUserName:function(t){return this.storage.getUserName(t)}});