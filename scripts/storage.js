function Storage(e){function t(){o.storageClient.authenticate(function(e){e?alert("Authentication error: "+e):n()})}function n(){var e=o.storageClient.getDatastoreManager();e.openDefaultDatastore(function(e,t){e?alert("Error opening default datastore: "+e):(o.eventsTable=t.getTable("events"),a())})}function a(){var e=o.eventsTable.query(),t=[];_.each(e,function(e){t.push(e.getFields())}),o.model.set("events",t)}var o=this;o.model=e,this.init=function(){o.storageClient=new Dropbox.Client({key:"1eg429deptchqw3"}),t()},this.getUserName=function(e){return o.storageClient.getAccountInfo(function(t,n){e(n.name)})},this.createEvent=function(e){var t=o.eventsTable.query({type:e.type,date:moment(e.date).startOf("day").toDate()});if(1==t.length){var n=t[0].get("content"),a=n+"\n\n"+e.content;t[0].set("content",a);var i=_.filter(o.model.get("events"),function(t){return t.type==e.type&&moment(t.date).isSame(e.date,"day")});i[0].content=a}else o.eventsTable.insert(e),o.model.get("events").push(e)},this.deleteEvent=function(e,t){var n=o.eventsTable.query({id:e.id});n[0].deleteRecord(),_.each(t,function(n,a){n.id==e.id&&delete t[a]})},this.init()}